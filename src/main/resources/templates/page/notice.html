<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.thymeleaf.org ">

<head>
    <title>Fragrantia Admin Notice</title>

    <!-- meta Setting -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:description" content="향의 이야기 당신을 초대합니다.">
    <meta property="og:image" content="https://green-six.github.io/Fragrantia-User-Web/images/ogLogo.png">

    <!-- 외부 스타일시트(전역 <- 리셋포함) -->
    <link rel="icon" type="image/png" sizes="96x96" href="../../images/favicon-96x96.png">
    <link href="../../css/global.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/page/notice.css">
    <link rel="stylesheet" href="../../css/module/buttonNav.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <!-- 외부 스크립트 (자바스크립트, jQuery) -->
    <script src="https://kit.fontawesome.com/047a434073.js" crossorigin="anonymous"></script>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/buttonNav.js"></script>

</head>

<body>
<div id="header"></div>
<div class="wrap">
    <span class="h1">공지사항 관리</span>
</div>

<div class="wrap but_nav_box">
    <div class="button-nav">
        <a href="#"><i class="plus-button fa-regular fa-square-plus fa-xl" style="color: #000000;"></i></a>
        <a href="#"><i class="minus-button fa-regular fa-square-minus fa-xl" style="color: #000000;"></i></a>
    </div>
    <div class="select_box">
        <select id="category">
            <option>All</option>
            <option>Flower</option>
            <option>Perfume</option>
        </select>
    </div>
</div>

<div id="notice" class="wrap">

    <div id="modal" class="create-modal" style="display: none">
        <div class="create-modal-content">
            <h2>New Notice</h2>
            <form>
                <label for="title">제목</label>
                <input type="text" id="title" name="title"><br>

                <label for="content">내용</label>
                <textarea id="content" name="content"></textarea><br>

                <button id="modal-submit" type="submit">작성</button>
                <button id="modal-close">취소</button>
            </form>
        </div>
    </div>

    <!-- 테이블 영역 -->
    <table>
        <!-- 테이블 헤드 영역 -->
        <thead>
        <tr>
            <th class="check"><input type="checkbox" name="chkAll" id="chkAll"/></th>
            <th class="no">No</th>
            <th class="title">Title</th>
            <th class="admin">Admin</th>
            <th class="date">Date</th>
            <th class="view">View</th>
        </tr>
        </thead>

        <!-- 테이블 바디 영역 -->
        <tbody th:each="notice : ${notices}">
        <!-- 요약 내용 영역 -->
        <tr class="notice-header">
            <td class="check"><input type="checkbox" name="chk" id="chk"/></td>
            <td class="no" th:text="${notice.id}"></td>
            <td class="title" th:text="${notice.title}"></td>
            <td class="admin" th:text="${notice.name}"></td>
            <td class="date" th:text="${notice.createdAt}"></td>
            <td class="view" th:text="${notice.view}"></td>
        </tr>

        <!-- 본문 영역 -->
        <tr class="notice-content">
            <td colspan="6">
                <div class="content">
                    <h1 th:text="${notice.title}"></h1>
                    <textarea name="notice-textarea" class="notice-textarea" rows="6" cols="100" readonly th:text="${notice.content}"></textarea>
                </div>
                <div class="content_btn">
                    <button type="button" class="btn btn-dark edit-btn">Edit</button>
                </div>
            </td>
        </tr>

        </tbody>
    </table>

    <div class="pagination">
        <ul>
            <li><a th:href="@{${'notice?page=' + (currentPage - 1)}}" th:if="${currentPage > 0}">Prev</a></li>
            <li th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}">
                <a th:href="@{${'notice?page=' + pageNum}}" th:text="${pageNum + 1}" th:class="${pageNum == currentPage ? 'active' : ''}"></a>
            </li>
            <li><a th:href="@{${'notice?page=' + (currentPage + 1)}}" th:if="${currentPage < totalPages - 1}">Next</a></li>
        </ul>
    </div>

</div>

</body>

</html>
<script>
  // colspan size 조절 함수
let reColspan = function () {
  if ($(window).width() <= 425  ) {
    // colspan 속성이 6인 td 요소를 찾아서
    $("tr.notice-content td[colspan='6']").each(function () {
      // colspan 속성 값을 4으로 변경
      $(this).attr("colspan", "4");
    });
  }
  // 데스크탑 버전인 경우
  else {
    // colspan 속성이 4인 td 요소를 찾아서
    $("tr.notice-content td[colspan='4']").each(function () {
      // colspan 속성 값을 6으로 변경
      $(this).attr("colspan", "6");
    });
  }
}

$(document).ready(function () {
      const modalSubmit = document.getElementById("modal-submit");

        modalSubmit.addEventListener("click", () => {
            const json = {
                    title: $('#title').val(),
                    content: $('#content').val(),
                };

                $.ajax({
                    url: "/notice",
                    type: "POST",
                    contentType: 'application/json',
                    data: JSON.stringify(json),
                    success: function(){
                        alert("공지사항이 성공적으로 작성되었습니다.")
                    },
                    error: function(){
                        alert("simpleWithObject err");
                    }
                });
        modal.style.display = "none";
    });

  $('.notice-header').click(function () {
    var content = $(this).closest('tr').next('.notice-content');
    content.fadeToggle('slow'); // 클릭한 요소 열기/닫기
    $('.notice-content').not(content).fadeOut(); // 이미 열려있는 요소 닫기
  });
  $('input[type="checkbox"]').click(function (event) {
    event.stopPropagation(); // 클릭 이벤트 전파 방지
  });
  //시작 할때 colspan 화면 크기에 맞게 설정
  reColspan()

  // chkAll을 클릭했을 때, chkAll이 체크되어 있으면, name이 chk인 input 태그의 checked 속성을 true로 설정
  // >> 전체 체크 박스를 체크하면 모든 체크 박스 체크
  $("#chkAll").click(function () {
    if ($("#chkAll").is(":checked")) $("input[name=chk]").prop("checked", true);
    else $("input[name=chk]").prop("checked", false);
  });
  // name이 chk인 input 태그를 클릭하면, name이 chk인 요소의 개수를 total 변수에 저장.
  // name이 chk인 요소 중에 checked 되어 있는 요소의 개수를 checked 개수에 저장.
  $("input[name=chk]").click(function () {
    var total = $("input[name=chk]").length;
    var checked = $("input[name=chk]:checked").length;

    // total 값이 checked의 값와 같지 않으면 id가 chkAll인 객체의 checked 속성을 false로 바꿈.
    // 그게 아니면 checked 속성을 true로 바꿈.
    if (total != checked) $("#chkAll").prop("checked", false);
    else $("#chkAll").prop("checked", true);
  });

  // 수정버튼 동작
  const editBtns = document.querySelectorAll('.edit-btn');

  editBtns.forEach((editBtn) => {
  const noticeTextarea = editBtn.closest('.notice-content').querySelector('[name="notice-textarea"]');

  editBtn.addEventListener('click', () => {
      noticeTextarea.classList.add('editable');
      noticeTextarea.removeAttribute('readonly');

      editBtn.classList.add('hide');

      const saveBtn = document.createElement('button');
      saveBtn.type = 'button';
      saveBtn.className = 'btn btn-primary';
      saveBtn.innerText = 'Save';
      saveBtn.addEventListener('click', () => {
      noticeTextarea.classList.remove('editable');
      noticeTextarea.setAttribute('readonly', '');
      saveBtn.remove();
      editBtn.classList.remove('hide');
      alert('수정되었습니다.');
      });

    editBtn.parentNode.insertBefore(saveBtn, editBtn.nextSibling);
    });
  });
});

$(window).resize(
  //화면 바꿀 때 colspan 화면 크기에 맞게 설정
  reColspan

);







</script>